<!DOCTYPE HTML>
<!--
	Stellar by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<script type="text/javascript" src="instascan.min.js"></script> 

			<script>
		if ('serviceWorker' in navigator) { 
  		window.addEventListener('load', function() {   
    	navigator.serviceWorker.register('/sw.js').then(
      		function(registration) { 
        // Registration was successful
        	console.log('ServiceWorker registration successful with scope: ', registration.scope); }, 
      		function(err) { 
        // registration failed :( 
        	console.log('ServiceWorker registration failed: ', err); 
      		}); 
  			});
		}
		
		if (navigator.serviceWorker.controller) {
		  console.log('[PWA Builder] active service worker found, no need to register')
		} else {

		//Register the ServiceWorker
		  navigator.serviceWorker.register('pwabuilder-sw.js', {
		    scope: './'
		  }).then(function(reg) {
		    console.log('Service worker has been registered for scope:'+ reg.scope);
		  });
		}
		</script>

		<link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="icons/apple-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="icons/apple-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="icons/apple-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="icons/apple-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="icons/apple-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
		<link rel="icon" type="image/png" sizes="192x192"  href="icons/android-icon-192x192.png">
		<link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="icons/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
		<link rel="manifest" href="icons/manifest.json">
		<meta name="msapplication-TileColor" content="#ffffff">
		<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
		<meta name="theme-color" content="#ffffff">

		<title>Saral Pay</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<!-- <link rel="stylesheet" href="assets/css/main.css" /> -->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
		<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.1/font/css/open-iconic-bootstrap.min.css"/> -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
	</head>
	<body>
		<!-- As a heading -->
		<nav class="navbar navbar-dark bg-primary">
		  <!-- <span class="navbar-brand mb-0 h1"><i>Saral Pay</i></span> -->
		  <a class="navbar-brand" href="#" id="navHome"><i>Saral Pay</i></a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent" aria-expanded="false" aria-label="Toggle navigation">
			      <!-- <span class="oi oi-cart"></span> -->
			      <i class="fa fa-cart-plus" aria-hidden="true"><span class="badge badge-pill badge-danger" id="spnCartItemCount">0</span></i>
			</button>
		</nav>

		

		<div class="container" id="divHome">
			<div class="row">
				<div class="col-12">
					<canter><video id="preview" style="height:300px;"></video></center>
				</div>		
				<div class="col-12">
					<div class="" id="divProductCard">
				    	<h4 id="divProductTitle">Card title</h4>
				    	<p id="divProductPrice">Some quick example text to build on the card title and make up the bulk of the card's content. </p>
				    	<a href="#" class="btn btn-primary" id="btnAddToCart" productName='Parle-G' price=10>Add to Cart</a>
			    	</div>
			    </div>
			    <div class="col-12">
			      
				  	<table class="table mt-5">
				  	  <thead class="thead-light">
				  	  	<tr>
				  	  		<th colspan="2"><h3>Cart Items</h3></th>
				  	  		<th><div class="col-8"><a href="#" class="btn btn-dark" id="btnDiscardCart">Discard cart</a></div></th>
				  	  	</tr>
				  	  </thead>
					  <tbody id="tbodyCartItems">
					  </tbody>
					  <tfoot id="tfootCartItems">
					  	<tr class="table-primary">
					  		<td colspan="2">Total</td>
					  		<td id="tdTotalPrice" class="text-right"></td>
					  	</tr>
					  </tfoot>
					</table>
		    	</div>
		    	<div class="col-12 mb-5" id="divCheckoutButton">
		    		<button type="button" class="btn btn-primary btn-lg btn-block" id="btnCheckoutCart">Checkout cart</button>
		    	</div>
		    </div>
		</div>

		<div class="d-none" id="divPaytm">
			<div class="jumbotron">
		  		<p class="lead">Your cart amount is</p>
		  		<h1 class="display-3" id="divCartTotal">Rs. 300</h1>
			</div>
			<div>
				<img src="./images/paytmLogo.png"/>
			</div>
			<button type="button" class="btn btn-primary btn-lg btn-block" id="btnContinuePayment">Make payment</button>
		</div>
		<!-- Wrapper -->
		<div id="wrapper">
			<div id = "divError"></div>
		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>

			<script type="text/javascript">

			var scanQRCode = function() {
				let scanner = new Instascan.Scanner({ video: document.getElementById('preview'),  mirror: false });
				
				scanner.addListener('scan', function (content) {
					console.log(content);
					//$('#divError').append(content);

					var jsonContent = eval("(" + content + ")");

					$('#divProductCard').removeClass('d-none');
					$('#divProductTitle').html(jsonContent.productName);
					$('#divProductPrice').html(jsonContent.price);

					$('#btnAddToCart').attr('productName', jsonContent.productName);
					$('#btnAddToCart').attr('price', jsonContent.price);
				 });
			 
			 	Instascan.Camera.getCameras().then(function (cameras) {
				 
					//$('#divError').append(" cameras.length = "  + cameras.length);
				 	if (cameras.length > 0) {
				 		scanner.start(cameras[1]);
			   		} else {
			    		console.error('No cameras found.');
			    		$('#divError').append("No cameras found");
			   		}
				 
				 }).catch(function (e) {
			   		console.error(e);
			   		$('#divError').append(e);
				 });
			};
			
			// var onBtnCameraClick = function(){
			// 	$('#preview').removeClass('hide');
			// 	scanQRCode();
			// };

			var showCartItemList = function() {
				arrCartItems = JSON.parse(localStorage.getItem("cartItems")) || [];

				if(arrCartItems.length == 0) {
					sHtml = '<tr><td scope="row" colspan=3><center>Your cart is empty</center></td></tr>';
					$('#tbodyCartItems').html(sHtml);

					$('#tfootCartItems').addClass('d-none');
					$('#btnDiscardCart').addClass('d-none');
					$('#divCheckoutButton').addClass('d-none');
					return;
				}

				$('#tfootCartItems').removeClass('d-none');
				$('#btnDiscardCart').removeClass('d-none');
				$('#divCheckoutButton').removeClass('d-none');

				totalPrice = 0;
				$('#tbodyCartItems').html('');
				$.each(arrCartItems, function(k,v){
					rowNum = k + 1;
					totalPrice += parseInt(v.price);
					sHtml = '<tr><td scope="row">' + rowNum +'</th><td>'+ v.productName +'</td><td class="text-right">'+ v.price + '</td></tr>';
					$('#tbodyCartItems').append(sHtml);
					$('#tdTotalPrice').html(totalPrice);
				})

			};

			var onBtnAddToCartClick = function() {
				arrCartItems = JSON.parse(localStorage.getItem("cartItems")) || [];

				obj = {'productName': $(this).attr('productName'), 'price': $(this).attr('price')};
				arrCartItems.push(obj);

				$('#spnCartItemCount').html(arrCartItems.length);
				localStorage.setItem("cartItems", JSON.stringify(arrCartItems));
				showCartItemList();
			};

			var onBtnDiscardCartClick = function(){
				localStorage.removeItem("cartItems");
				$('#spnCartItemCount').html('0');
				showCartItemList();
			};

			var onBtnCheckoutCart = function(){
				$('#divHome').addClass('d-none');
				$('#divPaytm').removeClass('d-none');

				cartTotal = $('#tdTotalPrice').html();
				$('#divCartTotal').html('Rs. ' + cartTotal);
			};

			var onNavHome = function(){
				$('#divPaytm').addClass('d-none');
				$('#divHome').removeClass('d-none');
			};
			// jquery on ready function
			$(function() {
				scanQRCode();
				showCartItemList();
			    $("#btnAddToCart").on('click', onBtnAddToCartClick);
			    $('#btnDiscardCart').on('click', onBtnDiscardCartClick);
			    $('#btnCheckoutCart').on('click', onBtnCheckoutCart);
			    $('#navHome').on('click', onNavHome);
			    $('#btnContinuePayment').on('click', onBtnDiscardCartClick);
			});

			</script>
	</body>
</html>